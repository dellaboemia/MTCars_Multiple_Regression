---
title: "Transmission and Fuel Efficiency"
author: "John James"
date: "April 15, 2016"
output:
  html_document:
    fig_caption: yes
    keep_md: yes
    theme: journal
  pdf_document:
    latex_engine: xelatex
  word_document: default
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gvlma)
library(knitr)
library(kfigr)
library(printr)
library(car)
read_chunk("mt.R")
knitr::opts_chunk$set(fig.path = "../figures/", fig.height = 4, fig.width = 10, echo=TRUE, warning=FALSE)
```

```{r environment, echo = FALSE, message = F, eval = T}
<<environment>>
```

```{r data, echo = FALSE, message = F, eval = T}
<<data>>
```


```{r corrOutcome, echo = FALSE, message = F, eval = T}
<<corrOutcome>>
```


```{r corrPredictors, echo = FALSE, message = F, eval = T}
<<corrPredictors>>
```



```{r modelSets, echo = FALSE, message = F, eval = T}
<<modelSets>>
```

```{r getPvalue, echo = FALSE, message = F, eval = T}
<<getPvalue>>
```

```{r plots, echo = FALSE, message = F, eval = T}
<<plots>>
```

#Introduction
The purpose of this analysis was to explore 1974 Motor Trend Magazine fuel consumption data set to determine whether an automatic or manual transmission was better for MPG and to quantify the difference.

Multiple linear regression techniques were used to isolate the effect of transmission type and to separate the effects of confounding variables on mpg. The following regression equation best fit the data and met the basis assumptions of linear regression analysis.
$$Y_i = \beta_0 + \beta_1am_i + \beta_2log(wt_i) + \beta_3log(hp_i) + \epsilon_i$$
The analysis posits that transmission type has no statistically significant effect on fuel efficiency when other factors such as weight and horsepower were taken into consideration.

#Data
There were `r mtStats[5,1]` observations of 11 variables in the Motor Trend Cars dataset, 6 continuous, 5 categorical. `r figr("carsFormat", TRUE, type="Table")` outlines the structure of the dataset.  `r figr("mtStats", TRUE, type="Table")` presents the summary statistics for the continuous variables.  Miles per gallon ranged from `r mtStats[3,1]` to `r mtStats[4,1]`, with a mean of `r round(mtStats[1,1],2)` mpg. Weight, measured in 1000 lb, ranged from `r round(1000 * mtStats[3,5],2)` to `r round(1000 * mtStats[4,5],2)` lb, with a mean of `r round(1000 * mtStats[1,5],2)` lb.  Mean horsepower and displacement was `r round(mtStats[1,3],2)` and `r round(mtStats[1,2],2)` cubic inches, respectively.  

#Method
**Relationship Evaluation**
The first task was to understand the relationships between the variables and the outcome (mpg) and the relationships among the predictors. `r figr("cordf1", TRUE, type="Table")` shows the absolute value of the correlation between the dependent variables and mpg. Given the size of the dataset, it was assumed that the best model would have no more than four regressors. The scatterplot in `r figr("scatterPlot1", TRUE, type="Figure")` depicts the relationships among mpg and the top four variables most highly correlated with mpg. Several observations were made.  First, Displacement, horsepower and weight had a slighty curved relationship to mpg, suggesting a log transformation might improve linearity. Second, displacement was highly correlated with horsepower, cylinders, and weight, suggesting potential collinearity.  Lastly, cylinders were also highly correlated with horsepower, indicating potential collinearity.

**Model 1: Effect of Transmission Type on MPG**
A linear regression was calculated to predict mpg based on transmission type (am). The linear equation produced an adjusted R^2^ of `r round(summary(lm1)$adj.r.squared,3)` (F(`r summary(lm1)$fstatistic[2]`, `r summary(lm1)$fstatistic[3]`)=`r round(summary(lm1)$fstatistic[1],3)`, p < $`r round(lm1p,4)`$).  Though transmission type was found to be significant (β~0~ = `r round(summary(lm1)$coef[1,4],3)` and β~1~ = `r round(summary(lm1)$coef[2,4],3)`), the low R^2^ suggested other variables accounted for much of the variance in mpg. 

**Model 2: Full Model**
Next, a full model was constructed by adding each variable to a multiple regression model, in order of correlation with mpg.  The full regression model equation produced an adjusted R^2^ of `r round(summary(lm10)$adj.r.squared,3)` (F(`r summary(lm10)$fstatistic[2]`, `r summary(lm10)$fstatistic[3]`)=`r round(summary(lm10)$fstatistic[1],3)`, p < $`r round(lm10p,4)`$).  However, the exceeding high multi-collinearity indicated by the variance inflation factors listed in `r figr("vif2", TRUE, type="Table")` disqualified this model from selection.

**Model 3: Target Model**
The four predictors most highly correlated with fuel efficiency - weight, cylinders, displacement, and horsepower (`r figr("cordf1", TRUE, type="Table")`) - were added to the univariate model, one-by-one. The anova tests in `r figr("anova1", TRUE, type="Table")` indicate significant effect for transmission, weight, cylinders, and horsepower.  Due to a lack of significance and high correlation with the other factors (`r figr("scatterPlot1", TRUE, type="Figure")`), displacement was dropped from the model.  Cylinder was also dropped as a consequence of the relatively high correlation with transmission type(ρX,Y	= `r round(cordf2[5,2],3)`). Lastly, the model fit the coefficients to the log of weight and log of horsepower to improve linearity.


#Results
**Regression Model**
The regression model selected was:
$$Y_i = \beta_0 + \beta_1am_i + \beta_2log(wt_i) + \beta_3log(hp_i) + \epsilon_i$$
where:

* *$\beta_0$* = mean mpg for automatic car with weight and horsepower = 0
* *$\beta_1$* = increase in mpg for manual transmission 
* *$\beta_2$* = reduction in mpg for each unit log of 1000 lb of of weight 
* *$\beta_3$* = reduction in mpg for each unit log of hp

              
A significant regression equation was found (F(`r summary(lm72)$fstatistic[2]`, `r summary(lm72)$fstatistic[3]`)=`r round(summary(lm72)$fstatistic[1],3)`, p < $`r lm72p`$), with an adjusted R^2^ of `r round(summary(lm72)$adj.r.squared,3)`. Predicted mpg was equal to `r round(summary(lm72)$coef[1,1],3)`  + `r round(summary(lm72)$coef[2,1],3)` * (Transmission)  `r round(summary(lm72)$coef[3,1],3)` * (wt)  `r round(summary(lm72)$coef[4,1],3)` * (hp), where Transmission was coded as 0 = Auto, 1 = Manual, wt was the weight of the vehicle measured in 1000lb, and hp was gross horsepower. Miles per gallon increased by `r round(summary(lm72)$coef[2,1],3)` mpg for cars with manual transmissions, decreased by `r -round(summary(lm72)$coef[3,1],3)` mpg for each 1000 lb of weight, and decreased by `r -round(summary(lm72)$coef[4,1],3)` mpg for each unit of horsepower. Though weight and horsepower were significant predictors of mpg with p-values equal to $`r round(summary(lm72)$coef[3,4],4)`$ and $`r round(summary(lm72)$coef[4,4],4)`$ respectively, transmission type was not.  The p-value for transmission type was `r round(summary(lm72)$coef[2,4],3)`, significantly above our significance factor of α = 0.05.

**Regression Model Assumptions**
The linear regression basic assumptions hold for this model.

* *Existence:* The relationship between dependent and independent variables exists.  The model predictors produce an adjusted R^2^ of `r round(summary(lm72)$adj.r.squared,3)`, thereby explaining `r 100 * round(summary(lm72)$adj.r.squared,3)` percent of the variability in mpg.
* *Linearity:* The Residual vs Fitted plot shown in `r figr("plotlm72", TRUE, type="Figure")` illustrate the linear relationship between the predictors and the outcome (mpg) over the spectrum of values studied.  
* *Normality:* The Normal Q-Q plot in `r figr("plotlm72", TRUE, type="Figure")` evinces a normal distribution of y-values for the  given values of the explanatory variables.
* *Constant Variance:*  The Residuals vs Fitted plot in `r figr("plotlm72", TRUE, type="Figure")` evinces a constant variance over the given values of the explanatory variables.


#References
1. Green, S. B. (1991). How many subjects does it take to do a regression analysis? Multivariate Behavioral Research, 26,499‐510.

#Appendix

##Figures
```{r scatterPlot1, echo = FALSE, message = F, eval = T, anchor = "Figure", fig.height = 6}
print(sp1)
```
`r figr("scatterPlot1", TRUE, type="Figure")`: Scatterplot Matrix


```{r plotlm72, echo = FALSE, message = F, eval = T, anchor = "Figure", fig.height = 6}
layout(matrix(c(1:4),2,2))
plot(lm72, which = c(1,2,3,5))
```
`r figr("plotlm72", TRUE, type="Figure")`: Model 3: Target Model Fit Analysis

##Tables
`r figr("carsFormat", TRUE, type="Table")`: Format of Motor Trend Cars Data Set
```{r carsFormat, echo = FALSE, message = F, eval = T, anchor = "Table"}
carsFormat
```

`r figr("mtStats", TRUE, type="Table")`: Summary Statistics for Motor Trend Cars Continuous Variables
```{r mtStats, echo = FALSE, message = F, eval = T, anchor = "Table"}
mtStats
```

`r figr("cordf1", TRUE, type="Table")`: MPG Correlation Table (Absolute Value)
```{r cordf1, echo = FALSE, message = F, eval = T, anchor = "Table"}
cordf1
```


`r figr("vif2", TRUE, type="Table")`: Model 2: Full Regression Model Variance Inflation Factors
```{r vif2, echo = FALSE, message = F, eval = T, anchor = "Table"}
vif(lm10)
```

`r figr("anova1", TRUE, type="Table")`: Model Series Coefficient Significance Test
```{r anova1, echo = FALSE, message = F, eval = T, anchor = "Table"}
print(anova(lm1, lm2, lm3, lm4, lm5))
```


```{r echo = FALSE, message = F, eval = T}
anchors("index")
```
